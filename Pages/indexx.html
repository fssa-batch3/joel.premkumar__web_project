<!DOCTYPE html>
<html>

<head>
    <title>InvestX login</title>
    <link rel="stylesheet" type="text/css" href="../Assets/css/Indexx.css">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">

</head>

<body>

    <div class="main">
        <input type="checkbox" id="chk" aria-hidden="true">
        <div class="signup">
            <form id="form">
                <label for="chk" aria-hidden="true">Welcome to InvestX</label>
                <input type="text" name="name" id="name" placeholder="User name" pattern="(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$"  title="UpperCase, LowerCase, Number/SpecialChar and min 8 Chars" required>
                <input type="email" name="email" id="mail" placeholder="Email" required>
                <input type="password" id="password" name="password" placeholder="Password"
                    pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                    title="Enter a Uppercase,a lowercase, a number,a special character" required>
                <button id="user_signup">Sign up</button>
            </form>
        </div>
        <div class="login">
            <form id="login_page">
                <label for="chk" aria-hidden="true">Login</label>
                <input type="text" id="email" name="email" placeholder="Email" required>
                <input type="password" id="pass" name="pass" placeholder="Password" required>
                <button id="login">Login</button>
            </form>
        </div>
    </div>

    <script>

        // signup code
        function signup() {

            // getting the values from input 
            let username = document.getElementById("name").value;
            let email = document.getElementById("mail").value;
            let pass = document.getElementById("password").value;
            let checkbox = document.getElementById("chk")
            let arr = localStorage.getItem("arr") ? JSON.parse(localStorage.getItem("arr")) : [];
            let res;

            // create a object and assign the value
            if (arr == "") {

                let user_data = {
                    "user_name": username,
                    "email": email,
                    "password": pass
                }

                arr.push(user_data)
                localStorage.setItem("arr", JSON.stringify(arr))
                alert("Account created SuccesfullyðŸ‘")
                checkbox.setAttribute("checked","")

            }
            else {
                let check = JSON.parse(localStorage.getItem("arr"))
                check.find(element => {
                    console.log(element)
                    if (element["email"] == email) {
                        return res = 1;
                    }
                })
                if (res == 1) {
                    alert("email already taken")
                }
                else {
                    let user_data = {
                        "user_name": username,
                        "email": email,
                        "password": pass
                    }

                    arr.push(user_data)
                    localStorage.setItem("arr", JSON.stringify(arr))
                    alert("Account created SuccesfullyðŸ‘")
                    checkbox.setAttribute("checked","")
                }
            }
        }




        document.getElementById("form").addEventListener("submit", (el) => {
            el.preventDefault()
            signup()
        })





        // login code 

        document.getElementById("login").addEventListener("click", (e) => {
            // alert("ok")
            e.preventDefault()
            check()
        })

        function check() {
            // i.preventDefault()
            let user_email = document.getElementById("email").value
            let pass = document.getElementById("pass").value

            let details = JSON.parse(localStorage.getItem("arr"));

            let datas = {
                "user_email": user_email,
                "password": pass
            }
            let res;

            details.find(e => {
                // console.log(e)
                if ((e["email"] == user_email) && (e["password"] == pass)) {
                    return res = 1;
                    // alert("crt");
                }
                else {
                    return res = 0;
                    alert("Invalid password or email");
                }
            });

            if (res == 1) {
                alert("logged in")
                localStorage.setItem("profile_details", JSON.stringify(datas))
                window.location.href = "./login.html"

            }
            else {
                alert("error")
            }
        }


    </script>


</body>

</html>